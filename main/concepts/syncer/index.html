
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to register Kubernetes clusters using syncer
">
      
      
      
      
        <link rel="prev" href="../storage/">
      
      
        <link rel="next" href="../virtual-workspaces/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.11">
    
    
      
        <title>Registering Kubernetes Clusters using syncer - kcp</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#requirements" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="kcp" class="md-header__button md-logo" aria-label="kcp" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            kcp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Registering Kubernetes Clusters using syncer
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/en/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kcp-dev/kcp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="kcp" class="md-nav__button md-logo" aria-label="kcp" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    kcp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kcp-dev/kcp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">Concepts</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../authorization/" class="md-nav__link">
        Authorization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cache-server/" class="md-nav__link">
        Cache Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-mapper/" class="md-nav__link">
        Cluster Mapper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../concepts/" class="md-nav__link">
        Terminology for kcp
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../kubectl-kcp-plugin/" class="md-nav__link">
        Kubectl kcp plugin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../locations-and-scheduling/" class="md-nav__link">
        Placement, Locations and Scheduling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart-tenancy-and-apis/" class="md-nav__link">
        Quickstart: Tenancy and APIs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        Storage and stateful applications
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Registering Kubernetes Clusters using syncer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Registering Kubernetes Clusters using syncer
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instructions" class="md-nav__link">
    Instructions
  </a>
  
    <nav class="md-nav" aria-label="Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-resources-to-sync" class="md-nav__link">
    Select resources to sync.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-workspaces-to-the-location-workspace" class="md-nav__link">
    Bind workspaces to the Location Workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-a-workload" class="md-nav__link">
    Running a workload
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-syncer-development" class="md-nav__link">
    For syncer development
  </a>
  
    <nav class="md-nav" aria-label="For syncer development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-components" class="md-nav__link">
    Building components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-kcp-on-another-terminal" class="md-nav__link">
    Start kcp on another terminal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-in-a-kind-cluster-with-a-local-registry" class="md-nav__link">
    Running in a kind cluster with a local registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-locally" class="md-nav__link">
    Running locally
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../virtual-workspaces/" class="md-nav__link">
        Virtual Workspaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../workspaces/" class="md-nav__link">
        Workspaces
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../developers/">Developers</a>
          
            <label for="__nav_2_13">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_13">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../developers/controllers/" class="md-nav__link">
        Writing kcp-aware controllers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../developers/library-usage/" class="md-nav__link">
        Using kcp as a library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../developers/releasing/" class="md-nav__link">
        Publishing a new kcp release
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../developers/replicate-new-resource/" class="md-nav__link">
        Adding a new resource to the cache server and replication controller
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_14" >
      
      
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_14" id="__nav_2_14_label" tabindex="0">
          Investigations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_14_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_14">
          <span class="md-nav__icon md-icon"></span>
          Investigations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../investigations/_index/" class="md-nav__link">
        Investigations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../investigations/logical-clusters/" class="md-nav__link">
        Logical clusters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../investigations/minimal-api-server/" class="md-nav__link">
        Minimal API Server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../investigations/self-service-policy/" class="md-nav__link">
        Self-service policy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../investigations/transparent-multi-cluster/" class="md-nav__link">
        Transparent multi-cluster
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instructions" class="md-nav__link">
    Instructions
  </a>
  
    <nav class="md-nav" aria-label="Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#select-resources-to-sync" class="md-nav__link">
    Select resources to sync.
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bind-workspaces-to-the-location-workspace" class="md-nav__link">
    Bind workspaces to the Location Workspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-a-workload" class="md-nav__link">
    Running a workload
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#for-syncer-development" class="md-nav__link">
    For syncer development
  </a>
  
    <nav class="md-nav" aria-label="For syncer development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#building-components" class="md-nav__link">
    Building components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-kcp-on-another-terminal" class="md-nav__link">
    Start kcp on another terminal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-in-a-kind-cluster-with-a-local-registry" class="md-nav__link">
    Running in a kind cluster with a local registry
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-locally" class="md-nav__link">
    Running locally
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



  <h1>Registering Kubernetes Clusters using syncer</h1>

<p>In order to register a Kubernetes clusters with the kcp server,
users have to install a special component named <a href="https://github.com/kcp-dev/kcp/tree/main/docs/architecture#syncer">syncer</a>.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>kcp server</li>
<li><a href="../kubectl-kcp-plugin/">kcp kubectl plugin</a></li>
<li>kubernetes cluster</li>
</ul>
<h2 id="instructions">Instructions</h2>
<ol>
<li>
<p>(Optional) Skip this step, if you already have a physical cluster.
   Create a kind cluster to back the sync target:</p>
<p>```sh
$ kind create cluster
Creating cluster "kind" ...
<snip>
Set kubectl context to "kind-kind"
You can now use your cluster with:</p>
<p>kubectl cluster-info --context kind-kind
```</p>
</li>
</ol>
<p>{{% alert title="Note" color="primary" %}}
This step sets current context to the new kind cluster. Make sure to use a KCP kubeconfig for the next steps unless told otherwise.
{{% /alert %}}</p>
<ol>
<li>
<p>Create an organisation and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace create my-org --enter
Workspace "my-org" (type root:organization) created. Waiting for it to be ready...
Workspace "my-org" (type root:organization) is ready to use.
Current workspace is "root:my-org" (type "root:organization").</code></p>
</li>
<li>
<p>Enable the syncer for a p-cluster:</p>
<p><code>sh
kubectl kcp workload sync &lt;synctarget name&gt; --syncer-image &lt;image name&gt; -o syncer.yaml</code></p>
<p>Where <code>&lt;image name&gt;</code> <a href="https://github.com/kcp-dev/kcp/pkgs/container/kcp%2Fsyncer">one of the syncer images</a> for your corresponding KCP release (e.g. <code>ghcr.io/kcp-dev/kcp/syncer:v0.7.5</code>).</p>
</li>
<li>
<p>Apply the manifest to the p-cluster:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl apply -f syncer.yaml
namespace/kcp-syncer-kind-1owee1ci created
serviceaccount/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci-token created
clusterrole.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
clusterrolebinding.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci created
deployment.apps/kcp-syncer-kind-1owee1ci created</code></p>
<p>and it will create a <code>kcp-syncer</code> deployment:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl -n kcp-syncer-kind-1owee1ci get deployments
NAME     READY   UP-TO-DATE   AVAILABLE   AGE
kcp-syncer   1/1     1            1           13m</code></p>
</li>
<li>
<p>Wait for the kcp sync target to go ready:</p>
<p><code>bash
kubectl wait --for=condition=Ready synctarget/&lt;mycluster&gt;</code></p>
<h3 id="select-resources-to-sync">Select resources to sync.</h3>
</li>
</ol>
<p>Syncer will by default use the <code>kubernetes</code> APIExport in <code>root:compute</code> workspace and sync <code>deployments/services/ingresses</code>
to the physical cluster. The related API schemas of the physical cluster should be comptible with kubernetes 1.24. User can
select to sync other resources in physical clusters or from other APIExports on kcp server.</p>
<p>To sync resources that the KCP server does not have an APIExport to support yet, run</p>
<pre><code class="language-sh">kubectl kcp workload sync &lt;mycluster&gt; --syncer-image &lt;image name&gt; --resources foo.bar -o syncer.yaml
</code></pre>
<p>And apply the generated manifests to the physical cluster. The syncer will then import the API schema of foo.bar
to the workspace of the synctarget, following up with an auto generated kubernetes APIExport/APIBinding in the same workspace.
You can then create foo.bar in this workspace, or create an APIBinding in another workspace to bind this APIExport.</p>
<p>To sync resource from another existing APIExport in the KCP server, run</p>
<pre><code class="language-sh">kubectl kcp workload sync &lt;mycluster&gt; --syncer-image &lt;image name&gt; --apiexports another-workspace:another-apiexport -o syncer.yaml
</code></pre>
<p>Syncer will start syncing the resources in this <code>APIExport</code> as long as the <code>SyncTarget</code> has compatible API schemas.</p>
<p>To see if a certain resource is supported to be synced by the syncer, you can check the state of the <code>syncedResources</code> in <code>SyncTarget</code>
status.</p>
<h3 id="bind-workspaces-to-the-location-workspace">Bind workspaces to the Location Workspace</h3>
<p>After the <code>SyncTarget</code> is ready, switch to any workspace containing some workloads that you want to sync to this <code>SyncTarget</code>, and run</p>
<pre><code class="language-sh">kubectl kcp bind compute &lt;workspace of synctarget&gt;
</code></pre>
<p>This command will create a <code>Placement</code> in the workspace. By default, it will also create <code>APIBinding</code>s for global kubernetes <code>APIExport</code> and
kubernetes <code>APIExport</code> in workspace of <code>SyncTarget</code>, if any of these <code>APIExport</code>s are supported by the <code>SyncTarget</code>.</p>
<p>Alternatively, if you would like to bind other <code>APIExport</code>s which are supported by the <code>SyncerTarget</code>, run:</p>
<pre><code>kubectl kcp bind compute &lt;workspace of synctarget&gt; --apiexports &lt;apiexport workspace&gt;:&lt;apiexport name&gt;
</code></pre>
<p>In addition, you can specify the certain location or namespace to create placement. e.g.</p>
<pre><code>kubectl kcp bind compute &lt;workspace of synctarget&gt; --location-selectors=env=test --namespace-selector=purpose=workload
</code></pre>
<p>this command will create a <code>Placement</code> selecting a <code>Location</code> with label <code>env=test</code> and bind the selected <code>Location</code> to namespaces with
label <code>purpose=workload</code>. See more details of placement and location <a href="../locations-and-scheduling/">here</a></p>
<h3 id="running-a-workload">Running a workload</h3>
<ol>
<li>
<p>Create a deployment:</p>
<p><code>sh
kubectl create deployment kuard --image gcr.io/kuar-demo/kuard-amd64:blue</code></p>
</li>
</ol>
<p>{{% alert title="Note" color="primary" %}}
Replace "gcr.io/kuar-demo/kuard-amd64:blue" with "gcr.io/kuar-demo/kuard-arm64:blue" in case you're running
an Apple M1 based virtual machine.
{{% /alert %}}</p>
<ol>
<li>
<p>Verify the deployment on the local workspace:</p>
<p><code>sh
$ kubectl rollout status deployment/kuard
Waiting for deployment "kuard" rollout to finish: 0 of 1 updated replicas are available...
deployment "kuard" successfully rolled out</code></p>
</li>
</ol>
<h2 id="for-syncer-development">For syncer development</h2>
<h3 id="building-components">Building components</h3>
<p>The syncer, kcp and kubectl plugins should come from the same build, so they are compatible with each other.</p>
<p>To build, make the root kcp folder your current working directory and run:</p>
<pre><code class="language-bash">make build-all install build-kind-images
</code></pre>
<p>If your go version is not 1.19, which is the expected version, you need to run</p>
<pre><code class="language-bash">IGNORE_GO_VERSION=1 make build-all install build-kind-images
</code></pre>
<p>Make a note of the syncer image that is produced by this build, which is in the output near the end. It should be something like <code>kind.local/syncer-c2e3073d5026a8f7f2c47a50c16bdbec:8287441974cf604dd93da5e6d010a78d38ae49733ea3a5031048a516101dd8a2</code>. This will be used by the <code>kubectl kcp workload sync ...</code> command, below.</p>
<p>The kubectl kcp plugin binaries should be first in your path so kubectl picks them up.</p>
<pre><code class="language-bash">which kubectl-kcp
</code></pre>
<p>should point to the kubectl-kcp you have just built in your <code>$GOPATH/bin</code>, and not any other installed version.</p>
<h3 id="start-kcp-on-another-terminal">Start kcp on another terminal</h3>
<pre><code class="language-bash">kcp start
</code></pre>
<h3 id="running-in-a-kind-cluster-with-a-local-registry">Running in a kind cluster with a local registry</h3>
<p>You can run the syncer in a kind cluster for development.</p>
<ol>
<li>Create a <code>kind</code> cluster with a local registry to simplify syncer development
   by executing the following script:</li>
</ol>
<p><code>bash
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/kubernetes-sigs/kind/main/site/static/examples/kind-with-registry.sh)"</code></p>
<ol>
<li>
<p>From the kcp root directory:
    <code>bash
    export KUBECONFIG=.kcp/admin.kubeconfig</code></p>
</li>
<li>
<p>Create a location workspace and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace create my-locations --enter
Workspace "my-locations" (type root:organization) created. Waiting for it to be ready...
Workspace "my-locations" (type root:organization) is ready to use.
Current workspace is "root:my-locations" (type "root:organization").</code></p>
</li>
<li>
<p>To create the synctarget and use the image pushed to the local registry, supply <code>&lt;image name&gt;</code> to the
   <code>kcp workload sync</code> plugin command, where <code>&lt;image name&gt;</code> was captured in the build steps, above.</p>
<p><code>sh
kubectl kcp workload sync kind --syncer-image &lt;image name&gt; -o syncer.yaml</code></p>
</li>
<li>
<p>Create a second workspace for your workloads and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace ..
$ kubectl kcp workspace create my-workloads --enter
Workspace "my-workloads" (type root:organization) created. Waiting for it to be ready...
Workspace "my-workloads" (type root:organization) is ready to use.
Current workspace is "root:my-workloads" (type "root:organization").</code></p>
</li>
<li>
<p>Bind it to the <code>my-locations</code> workspace with the synctarget:</p>
<p><code>bash
kubectl kcp bind compute "root:my-locations"</code></p>
</li>
<li>
<p>Apply the manifest to the p-cluster:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl apply -f syncer.yaml
namespace/kcp-syncer-kind-1owee1ci created
serviceaccount/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci-token created
clusterrole.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
clusterrolebinding.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci created
deployment.apps/kcp-syncer-kind-1owee1ci created</code></p>
<p>and it will create a <code>kcp-syncer</code> deployment:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl -n kcp-syncer-kind-1owee1ci get deployments
NAME     READY   UP-TO-DATE   AVAILABLE   AGE
kcp-syncer   1/1     1            1           13m</code></p>
</li>
<li>
<p>Wait for the kcp sync target to go ready:</p>
<p><code>bash
kubectl wait --for=condition=Ready synctarget/&lt;mycluster&gt;</code></p>
</li>
<li>
<p>Add a deployment to the my-workloads workspace and check the p-cluster to see if the workload has been created there:</p>
<p><code>bash
kubectl create deployment --image=gcr.io/kuar-demo/kuard-amd64:blue --port=8080 kuard</code></p>
</li>
</ol>
<h3 id="running-locally">Running locally</h3>
<p>TODO(m1kola): we need a less hacky way to run locally: needs to be more close
to what we have when running inside the kind with own kubeconfig.</p>
<p>This assumes that KCP is also being run locally.</p>
<ol>
<li>
<p>Create a kind cluster to back the sync target:</p>
<p>```sh
$ kind create cluster
Creating cluster "kind" ...
<snip>
Set kubectl context to "kind-kind"
You can now use your cluster with:</p>
<p>kubectl cluster-info --context kind-kind
```</p>
</li>
<li>
<p>Make sure to use kubeconfig for your local KCP:</p>
<p><code>bash
export KUBECONFIG=.kcp/admin.kubeconfig</code></p>
</li>
<li>
<p>Create an organisation and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace create my-org --enter
Workspace "my-org" (type root:organization) created. Waiting for it to be ready...
Workspace "my-org" (type root:organization) is ready to use.
Current workspace is "root:my-org" (type "root:organization").</code></p>
</li>
<li>
<p>Enable the syncer for a p-cluster:</p>
<p><code>sh
kubectl kcp workload sync &lt;mycluster&gt; --syncer-image &lt;image name&gt; -o syncer.yaml</code></p>
<p><code>&lt;image name&gt;</code> can be anything here as it will only be used to generate <code>syncer.yaml</code> which we are not going to apply.</p>
</li>
<li>
<p>Gather data required for the syncer:</p>
<p><code>bash
syncTargetName=&lt;mycluster&gt;
syncTargetUID=$(kubectl get synctarget $syncTargetName -o jsonpath="{.metadata.uid}")
fromCluster=$(kubectl ws current --short)</code></p>
</li>
<li>
<p>Run the following snippet:</p>
<p><code>bash
go run ./cmd/syncer \
  --from-kubeconfig=.kcp/admin.kubeconfig \
  --from-context=base \
  --to-kubeconfig=$HOME/.kube/config \
  --sync-target-name=$syncTargetName \
  --sync-target-uid=$syncTargetUID \
  --from-cluster=$fromCluster \
  --resources=configmaps \
  --resources=deployments.apps \
  --resources=secrets \
  --resources=serviceaccounts \
  --qps=30 \
  --burst=20</code></p>
</li>
<li>
<p>Wait for the kcp sync target to go ready:</p>
<p><code>bash
kubectl wait --for=condition=Ready synctarget/&lt;mycluster&gt;</code></p>
</li>
</ol>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.6df46069.min.js"></script>
      
    
  </body>
</html>