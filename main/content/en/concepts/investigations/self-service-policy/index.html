<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../../img/favicon.ico">
        <title>Self-service policy - kcp</title>
        <link href="../../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../../../../css/version-select.css" rel="stylesheet">

        <script src="../../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../../..">kcp</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Content <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">En</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../" class="dropdown-item"><img src="logo.png" style="vertical-align: middle;" /> kcp Documentation</a>
</li>
            
<li>
    <a href="../../../CONTRIBUTING/" class="dropdown-item">Contributing to kcp</a>
</li>
            
<li>
    <a href="../../../GOALS/" class="dropdown-item">Project Goals</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Concepts</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../" class="dropdown-item">Terminology for kcp</a>
</li>
            
<li>
    <a href="../../authorization/" class="dropdown-item">Authorization</a>
</li>
            
<li>
    <a href="../../cache-server/" class="dropdown-item">Cache Server</a>
</li>
            
<li>
    <a href="../../cluster-mapper/" class="dropdown-item">Cluster Mapper</a>
</li>
            
<li>
    <a href="../../kubectl-kcp-plugin/" class="dropdown-item">Kubectl kcp plugin</a>
</li>
            
<li>
    <a href="../../locations-and-scheduling/" class="dropdown-item">Placement, Locations and Scheduling</a>
</li>
            
<li>
    <a href="../../quickstart-tenancy-and-apis/" class="dropdown-item">Quickstart: Tenancy and APIs</a>
</li>
            
<li>
    <a href="../../storage/" class="dropdown-item">Storage and stateful applications</a>
</li>
            
<li>
    <a href="../../syncer/" class="dropdown-item">Registering Kubernetes Clusters using syncer</a>
</li>
            
<li>
    <a href="../../virtual-workspaces/" class="dropdown-item">Virtual Workspaces</a>
</li>
            
<li>
    <a href="../../workspaces/" class="dropdown-item">Workspaces</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Developers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../developers/" class="dropdown-item">Developers</a>
</li>
            
<li>
    <a href="../../developers/controllers/" class="dropdown-item">Writing kcp-aware controllers</a>
</li>
            
<li>
    <a href="../../developers/library-usage/" class="dropdown-item">Using kcp as a library</a>
</li>
            
<li>
    <a href="../../developers/releasing/" class="dropdown-item">Publishing a new kcp release</a>
</li>
            
<li>
    <a href="../../developers/replicate-new-resource/" class="dropdown-item">Adding a new resource to the cache server and replication controller</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Investigations</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../logical-clusters/" class="dropdown-item">Logical clusters</a>
</li>
            
<li>
    <a href="../minimal-api-server/" class="dropdown-item">Minimal API Server</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Self-service policy</a>
</li>
            
<li>
    <a href="../transparent-multi-cluster/" class="dropdown-item">Transparent multi-cluster</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Reference</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Cli</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../reference/cli/kcp/" class="dropdown-item">kcp</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_bind/" class="dropdown-item">kcp bind</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_bind_apiexport/" class="dropdown-item">kcp bind apiexport</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_bind_compute/" class="dropdown-item">kcp bind compute</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_claims/" class="dropdown-item">kcp claims</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_claims_get/" class="dropdown-item">kcp claims get</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_claims_get_apibinding/" class="dropdown-item">kcp claims get apibinding</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_crd/" class="dropdown-item">kcp crd</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_crd_snapshot/" class="dropdown-item">kcp crd snapshot</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workload/" class="dropdown-item">kcp workload</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workload_cordon/" class="dropdown-item">kcp workload cordon</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workload_drain/" class="dropdown-item">kcp workload drain</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workload_sync/" class="dropdown-item">kcp workload sync</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workload_uncordon/" class="dropdown-item">kcp workload uncordon</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workspace/" class="dropdown-item">kcp workspace</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workspace_create-context/" class="dropdown-item">kcp workspace create-context</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workspace_create/" class="dropdown-item">kcp workspace create</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workspace_current/" class="dropdown-item">kcp workspace current</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workspace_tree/" class="dropdown-item">kcp workspace tree</a>
</li>
            
<li>
    <a href="../../../reference/cli/kcp_workspace_use/" class="dropdown-item">kcp workspace use</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Crd</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../reference/crd/apibindings.apis.kcp.io/" class="dropdown-item">APIBinding</a>
</li>
            
<li>
    <a href="../../../reference/crd/apiexportendpointslices.apis.kcp.io/" class="dropdown-item">APIExportEndpointSlice</a>
</li>
            
<li>
    <a href="../../../reference/crd/apiexports.apis.kcp.io/" class="dropdown-item">APIExport</a>
</li>
            
<li>
    <a href="../../../reference/crd/apiresourceimports.apiresource.kcp.io/" class="dropdown-item">APIResourceImport</a>
</li>
            
<li>
    <a href="../../../reference/crd/apiresourceschemas.apis.kcp.io/" class="dropdown-item">APIResourceSchema</a>
</li>
            
<li>
    <a href="../../../reference/crd/locations.scheduling.kcp.io/" class="dropdown-item">Location</a>
</li>
            
<li>
    <a href="../../../reference/crd/logicalclusters.core.kcp.io/" class="dropdown-item">LogicalCluster</a>
</li>
            
<li>
    <a href="../../../reference/crd/negotiatedapiresources.apiresource.kcp.io/" class="dropdown-item">NegotiatedAPIResource</a>
</li>
            
<li>
    <a href="../../../reference/crd/partitions.topology.kcp.io/" class="dropdown-item">Partition</a>
</li>
            
<li>
    <a href="../../../reference/crd/partitionsets.topology.kcp.io/" class="dropdown-item">PartitionSet</a>
</li>
            
<li>
    <a href="../../../reference/crd/placements.scheduling.kcp.io/" class="dropdown-item">Placement</a>
</li>
            
<li>
    <a href="../../../reference/crd/shards.core.kcp.io/" class="dropdown-item">Shard</a>
</li>
            
<li>
    <a href="../../../reference/crd/synctargets.workload.kcp.io/" class="dropdown-item">SyncTarget</a>
</li>
            
<li>
    <a href="../../../reference/crd/workspaces.tenancy.kcp.io/" class="dropdown-item">Workspace</a>
</li>
            
<li>
    <a href="../../../reference/crd/workspacetypes.tenancy.kcp.io/" class="dropdown-item">WorkspaceType</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Enhancements <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../../enhancements/0001_project_enhancements/" class="dropdown-item">0001: Project process refinement for 2023</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../minimal-api-server/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../transparent-multi-cluster/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#goal" class="nav-link">Goal</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#problem" class="nav-link">Problem</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#approach" class="nav-link">Approach</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#areas-of-investigation" class="nav-link">Areas of investigation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#progress" class="nav-link">Progress</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h2 id="goal">Goal</h2>
<p>Improve consistency and reusability of self-service and policy enforcement across multiple Kubernetes clusters.</p>
<blockquote>
<p>Just like Kubernetes standardized deploying containerized software onto a small set of machines, we want to standardize self-service of application focused integration across multiple teams with organizational control.</p>
</blockquote>
<p>Or possibly</p>
<blockquote>
<p>Kubernetes standardized deploying applications into chunks of capacity.  We want to standardize isolating and integrating application teams across organizations, and to do that in a way that makes applications everywhere more secure.</p>
</blockquote>
<h2 id="problem">Problem</h2>
<p>A key component of large Kubernetes clusters is shared use, where the usage pattern might vary from externally controlled (via gitops / existing operational tools) to a permissive self-service model.  The most common partitioning model in Kubernetes is namespace, and the second most common model is cluster.</p>
<p>Self-service is currently limited by the set of resources that are namespace scoped for the former, and by the need to parameterize and configure multiple clusters consistently for the latter. Cluster partitioning can uniquely offer distinct sets of APIs to consumers. Namespace partitioning is cheap up until the scale limits of the cluster (~10k namespaces), while cluster partitioning usually has a fixed cost per cluster in operational and resource usage, as well as lower total utilization.</p>
<p>Once a deployment reaches the scale limit of a single cluster, operators often need to redefine their policies and tools to work in a multi-cluster environment. Many large deployers create their own systems for managing self-service policy above their clusters and leverage individual subsystems within Kubernetes to accomplish those goals.</p>
<h2 id="approach">Approach</h2>
<p>The logical cluster concept offers an opportunity to allow self-service at a cluster scope, with the effective cost of the namespace partitioning scheme. In addition, the separation of workload at control plane (kcp) and data plane (physical cluster) via <a href="../transparent-multi-cluster/">transparent multi-cluster</a> or similar schemes allows strong policy control of what configuration is allowed (reject early), restriction of the supported API surface area for workload APIs (limit / control certain fields like pod security), and limits the access of individual users to the underlying infra (much like clusters limit access to nodes).</p>
<p>It should be possible to accomplish current self-service namespace and cluster partitioning via the logical cluster mechanism + policy enforcement, and to incentivize a wider range of "external policy control" users to adopt self-service via stronger control points and desirable use cases (multi-cluster resiliency for apps).</p>
<p>We want to enable concrete points of injection of policy that are difficult today in Kubernetes tenancy:</p>
<ol>
<li>The acquisition of a new logical cluster with <strong>capabilities</strong> and <strong>constraints</strong></li>
<li>How the APIs in a logical cluster are <strong>transformed</strong> to an underlying cluster</li>
<li>How to manage the evolution of APIs available to a logical cluster over time</li>
<li>New hierarchal policy options are more practical since different logical clusters can have different APIs</li>
</ol>
<h2 id="areas-of-investigation">Areas of investigation</h2>
<ul>
<li>Using logical clusters as a mechanism for tenancy, but having a backing implementation that can change</li>
<li>I.e. materialize logical clusters as an API resource in a separate logical cluster</li>
<li>Or implementing logical clusters outside the system and having the kcp server implementation be a shim</li>
<li>Formal "policy module" implementations that can be plugged into a minimal API server while using logical cluster impl</li>
<li>Catalog the set of tenancy constructs in use in Kube</li>
<li>Draw heavily on sig-multitenancy explorations - work done by <a href="https://github.com/kubernetes-sigs/cluster-api-provider-nested/tree/main/virtualcluster">cluster api nested</a>, <a href="https://github.com/kubernetes-sigs/cluster-api-provider-nested/tree/main/virtualcluster">virtual clusters</a>, namespace tenancy, and <a href="https://github.com/kubernetes-sigs/hierarchical-namespaces">hierarchal namespace</a> designs</li>
<li>Look at reference materials created by large organizational adopters of Kube</li>
<li>Consider making "cost" a first class control concept alongside quota and RBAC (i.e. a service load balancer "costs" $1, whereas a regular service costs $0.001)</li>
<li>Could this more effectively limit user action</li>
<li>Explore hierarchy of policy - if logical clusters are selectable by label, could you have composability of policy using controllers</li>
<li>Explore using implicit resources</li>
<li>i.e. within a logical cluster have all resources of type RoleBinding be fetched from two sources - within the cluster, and in a separate logical cluster - and merged, so that you could change the global source and watches would still fire</li>
<li>Impliict resources have risk though - no way to "lock" them so the consequences of an implicit change can be expensive</li>
</ul>
<h2 id="progress">Progress</h2>
<h3 id="simple-example-of-a-policy-implementation">Simple example of a policy implementation</h3>
<p>Building out an example flow that goes from creating a logical cluster resource that results in a logical cluster being accessible to client, with potential hook points for deeper integration.</p>
<h3 id="describe-a-complicated-policy-implementation">Describe a complicated policy implementation</h3>
<p>An example hosted multi-tenant service with billing, organizational policy, and tenancy isolation.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../../js/base.js" defer></script>
        <script src="../../../../../search/main.js" defer></script>
        <script src="../../../../../js/version-select.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
