<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>Registering Kubernetes Clusters using syncer - kcp</title>
        <link href="../../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="../../../../css/version-select.css" rel="stylesheet">

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../../..">kcp</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Content <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">En</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../" class="dropdown-item"><img src="logo.png" style="vertical-align: middle;" /> kcp Documentation</a>
</li>
            
<li>
    <a href="../../CONTRIBUTING/" class="dropdown-item">Contributing to kcp</a>
</li>
            
<li>
    <a href="../../GOALS/" class="dropdown-item">Project Goals</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Concepts</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../" class="dropdown-item">Terminology for kcp</a>
</li>
            
<li>
    <a href="../authorization/" class="dropdown-item">Authorization</a>
</li>
            
<li>
    <a href="../cache-server/" class="dropdown-item">Cache Server</a>
</li>
            
<li>
    <a href="../cluster-mapper/" class="dropdown-item">Cluster Mapper</a>
</li>
            
<li>
    <a href="../kubectl-kcp-plugin/" class="dropdown-item">Kubectl kcp plugin</a>
</li>
            
<li>
    <a href="../locations-and-scheduling/" class="dropdown-item">Placement, Locations and Scheduling</a>
</li>
            
<li>
    <a href="../quickstart-tenancy-and-apis/" class="dropdown-item">Quickstart: Tenancy and APIs</a>
</li>
            
<li>
    <a href="../storage/" class="dropdown-item">Storage and stateful applications</a>
</li>
            
<li>
    <a href="./" class="dropdown-item active">Registering Kubernetes Clusters using syncer</a>
</li>
            
<li>
    <a href="../virtual-workspaces/" class="dropdown-item">Virtual Workspaces</a>
</li>
            
<li>
    <a href="../workspaces/" class="dropdown-item">Workspaces</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Developers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../developers/" class="dropdown-item">Developers</a>
</li>
            
<li>
    <a href="../developers/controllers/" class="dropdown-item">Writing kcp-aware controllers</a>
</li>
            
<li>
    <a href="../developers/library-usage/" class="dropdown-item">Using kcp as a library</a>
</li>
            
<li>
    <a href="../developers/releasing/" class="dropdown-item">Publishing a new kcp release</a>
</li>
            
<li>
    <a href="../developers/replicate-new-resource/" class="dropdown-item">Adding a new resource to the cache server and replication controller</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Investigations</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../investigations/logical-clusters/" class="dropdown-item">Logical clusters</a>
</li>
            
<li>
    <a href="../investigations/minimal-api-server/" class="dropdown-item">Minimal API Server</a>
</li>
            
<li>
    <a href="../investigations/self-service-policy/" class="dropdown-item">Self-service policy</a>
</li>
            
<li>
    <a href="../investigations/transparent-multi-cluster/" class="dropdown-item">Transparent multi-cluster</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Reference</a>
    <ul class="dropdown-menu">
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Cli</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../reference/cli/kcp/" class="dropdown-item">kcp</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_bind/" class="dropdown-item">kcp bind</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_bind_apiexport/" class="dropdown-item">kcp bind apiexport</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_bind_compute/" class="dropdown-item">kcp bind compute</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_claims/" class="dropdown-item">kcp claims</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_claims_get/" class="dropdown-item">kcp claims get</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_claims_get_apibinding/" class="dropdown-item">kcp claims get apibinding</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_crd/" class="dropdown-item">kcp crd</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_crd_snapshot/" class="dropdown-item">kcp crd snapshot</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workload/" class="dropdown-item">kcp workload</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workload_cordon/" class="dropdown-item">kcp workload cordon</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workload_drain/" class="dropdown-item">kcp workload drain</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workload_sync/" class="dropdown-item">kcp workload sync</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workload_uncordon/" class="dropdown-item">kcp workload uncordon</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workspace/" class="dropdown-item">kcp workspace</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workspace_create-context/" class="dropdown-item">kcp workspace create-context</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workspace_create/" class="dropdown-item">kcp workspace create</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workspace_current/" class="dropdown-item">kcp workspace current</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workspace_tree/" class="dropdown-item">kcp workspace tree</a>
</li>
            
<li>
    <a href="../../reference/cli/kcp_workspace_use/" class="dropdown-item">kcp workspace use</a>
</li>
    </ul>
  </li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Crd</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../reference/crd/apibindings.apis.kcp.io/" class="dropdown-item">APIBinding</a>
</li>
            
<li>
    <a href="../../reference/crd/apiexportendpointslices.apis.kcp.io/" class="dropdown-item">APIExportEndpointSlice</a>
</li>
            
<li>
    <a href="../../reference/crd/apiexports.apis.kcp.io/" class="dropdown-item">APIExport</a>
</li>
            
<li>
    <a href="../../reference/crd/apiresourceimports.apiresource.kcp.io/" class="dropdown-item">APIResourceImport</a>
</li>
            
<li>
    <a href="../../reference/crd/apiresourceschemas.apis.kcp.io/" class="dropdown-item">APIResourceSchema</a>
</li>
            
<li>
    <a href="../../reference/crd/locations.scheduling.kcp.io/" class="dropdown-item">Location</a>
</li>
            
<li>
    <a href="../../reference/crd/logicalclusters.core.kcp.io/" class="dropdown-item">LogicalCluster</a>
</li>
            
<li>
    <a href="../../reference/crd/negotiatedapiresources.apiresource.kcp.io/" class="dropdown-item">NegotiatedAPIResource</a>
</li>
            
<li>
    <a href="../../reference/crd/partitions.topology.kcp.io/" class="dropdown-item">Partition</a>
</li>
            
<li>
    <a href="../../reference/crd/partitionsets.topology.kcp.io/" class="dropdown-item">PartitionSet</a>
</li>
            
<li>
    <a href="../../reference/crd/placements.scheduling.kcp.io/" class="dropdown-item">Placement</a>
</li>
            
<li>
    <a href="../../reference/crd/shards.core.kcp.io/" class="dropdown-item">Shard</a>
</li>
            
<li>
    <a href="../../reference/crd/synctargets.workload.kcp.io/" class="dropdown-item">SyncTarget</a>
</li>
            
<li>
    <a href="../../reference/crd/workspaces.tenancy.kcp.io/" class="dropdown-item">Workspace</a>
</li>
            
<li>
    <a href="../../reference/crd/workspacetypes.tenancy.kcp.io/" class="dropdown-item">WorkspaceType</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Enhancements <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../../enhancements/0001_project_enhancements/" class="dropdown-item">0001: Project process refinement for 2023</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../storage/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../virtual-workspaces/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="2"><a href="#requirements" class="nav-link">Requirements</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#instructions" class="nav-link">Instructions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="2"><a href="#for-syncer-development" class="nav-link">For syncer development</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>In order to register a Kubernetes clusters with the kcp server,
users have to install a special component named <a href="https://github.com/kcp-dev/kcp/tree/main/docs/architecture#syncer">syncer</a>.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>kcp server</li>
<li><a href="../kubectl-kcp-plugin/">kcp kubectl plugin</a></li>
<li>kubernetes cluster</li>
</ul>
<h2 id="instructions">Instructions</h2>
<ol>
<li>
<p>(Optional) Skip this step, if you already have a physical cluster.
   Create a kind cluster to back the sync target:</p>
<p>```sh
$ kind create cluster
Creating cluster "kind" ...
<snip>
Set kubectl context to "kind-kind"
You can now use your cluster with:</p>
<p>kubectl cluster-info --context kind-kind
```</p>
</li>
</ol>
<p>!!! note
    This step sets current context to the new kind cluster. Make sure to use a KCP kubeconfig for the next steps unless told otherwise.</p>
<ol>
<li>
<p>Create an organisation and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace create my-org --enter
Workspace "my-org" (type root:organization) created. Waiting for it to be ready...
Workspace "my-org" (type root:organization) is ready to use.
Current workspace is "root:my-org" (type "root:organization").</code></p>
</li>
<li>
<p>Enable the syncer for a p-cluster:</p>
<p><code>sh
kubectl kcp workload sync &lt;synctarget name&gt; --syncer-image &lt;image name&gt; -o syncer.yaml</code></p>
<p>Where <code>&lt;image name&gt;</code> <a href="https://github.com/kcp-dev/kcp/pkgs/container/kcp%2Fsyncer">one of the syncer images</a> for your corresponding KCP release (e.g. <code>ghcr.io/kcp-dev/kcp/syncer:v0.7.5</code>).</p>
</li>
<li>
<p>Apply the manifest to the p-cluster:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl apply -f syncer.yaml
namespace/kcp-syncer-kind-1owee1ci created
serviceaccount/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci-token created
clusterrole.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
clusterrolebinding.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci created
deployment.apps/kcp-syncer-kind-1owee1ci created</code></p>
<p>and it will create a <code>kcp-syncer</code> deployment:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl -n kcp-syncer-kind-1owee1ci get deployments
NAME     READY   UP-TO-DATE   AVAILABLE   AGE
kcp-syncer   1/1     1            1           13m</code></p>
</li>
<li>
<p>Wait for the kcp sync target to go ready:</p>
<p><code>bash
kubectl wait --for=condition=Ready synctarget/&lt;mycluster&gt;</code></p>
<h3 id="select-resources-to-sync">Select resources to sync.</h3>
</li>
</ol>
<p>Syncer will by default use the <code>kubernetes</code> APIExport in <code>root:compute</code> workspace and sync <code>deployments/services/ingresses</code>
to the physical cluster. The related API schemas of the physical cluster should be comptible with kubernetes 1.24. User can
select to sync other resources in physical clusters or from other APIExports on kcp server.</p>
<p>To sync resources that the KCP server does not have an APIExport to support yet, run</p>
<pre><code class="language-sh">kubectl kcp workload sync &lt;mycluster&gt; --syncer-image &lt;image name&gt; --resources foo.bar -o syncer.yaml
</code></pre>
<p>And apply the generated manifests to the physical cluster. The syncer will then import the API schema of foo.bar
to the workspace of the synctarget, following up with an auto generated kubernetes APIExport/APIBinding in the same workspace.
You can then create foo.bar in this workspace, or create an APIBinding in another workspace to bind this APIExport.</p>
<p>To sync resource from another existing APIExport in the KCP server, run</p>
<pre><code class="language-sh">kubectl kcp workload sync &lt;mycluster&gt; --syncer-image &lt;image name&gt; --apiexports another-workspace:another-apiexport -o syncer.yaml
</code></pre>
<p>Syncer will start syncing the resources in this <code>APIExport</code> as long as the <code>SyncTarget</code> has compatible API schemas.</p>
<p>To see if a certain resource is supported to be synced by the syncer, you can check the state of the <code>syncedResources</code> in <code>SyncTarget</code>
status.</p>
<h3 id="bind-workspaces-to-the-location-workspace">Bind workspaces to the Location Workspace</h3>
<p>After the <code>SyncTarget</code> is ready, switch to any workspace containing some workloads that you want to sync to this <code>SyncTarget</code>, and run</p>
<pre><code class="language-sh">kubectl kcp bind compute &lt;workspace of synctarget&gt;
</code></pre>
<p>This command will create a <code>Placement</code> in the workspace. By default, it will also create <code>APIBinding</code>s for global kubernetes <code>APIExport</code> and
kubernetes <code>APIExport</code> in workspace of <code>SyncTarget</code>, if any of these <code>APIExport</code>s are supported by the <code>SyncTarget</code>.</p>
<p>Alternatively, if you would like to bind other <code>APIExport</code>s which are supported by the <code>SyncerTarget</code>, run:</p>
<pre><code>kubectl kcp bind compute &lt;workspace of synctarget&gt; --apiexports &lt;apiexport workspace&gt;:&lt;apiexport name&gt;
</code></pre>
<p>In addition, you can specify the certain location or namespace to create placement. e.g.</p>
<pre><code>kubectl kcp bind compute &lt;workspace of synctarget&gt; --location-selectors=env=test --namespace-selector=purpose=workload
</code></pre>
<p>this command will create a <code>Placement</code> selecting a <code>Location</code> with label <code>env=test</code> and bind the selected <code>Location</code> to namespaces with
label <code>purpose=workload</code>. See more details of placement and location <a href="../locations-and-scheduling/">here</a></p>
<h3 id="running-a-workload">Running a workload</h3>
<ol>
<li>
<p>Create a deployment:</p>
<p><code>sh
kubectl create deployment kuard --image gcr.io/kuar-demo/kuard-amd64:blue</code></p>
</li>
</ol>
<p>!!! note
    Replace "gcr.io/kuar-demo/kuard-amd64:blue" with "gcr.io/kuar-demo/kuard-arm64:blue" in case you're running
    an Apple M1 based virtual machine.</p>
<ol>
<li>
<p>Verify the deployment on the local workspace:</p>
<p><code>sh
$ kubectl rollout status deployment/kuard
Waiting for deployment "kuard" rollout to finish: 0 of 1 updated replicas are available...
deployment "kuard" successfully rolled out</code></p>
</li>
</ol>
<h2 id="for-syncer-development">For syncer development</h2>
<h3 id="building-components">Building components</h3>
<p>The syncer, kcp and kubectl plugins should come from the same build, so they are compatible with each other.</p>
<p>To build, make the root kcp folder your current working directory and run:</p>
<pre><code class="language-bash">make build-all install build-kind-images
</code></pre>
<p>If your go version is not 1.19, which is the expected version, you need to run</p>
<pre><code class="language-bash">IGNORE_GO_VERSION=1 make build-all install build-kind-images
</code></pre>
<p>Make a note of the syncer image that is produced by this build, which is in the output near the end. It should be something like <code>kind.local/syncer-c2e3073d5026a8f7f2c47a50c16bdbec:8287441974cf604dd93da5e6d010a78d38ae49733ea3a5031048a516101dd8a2</code>. This will be used by the <code>kubectl kcp workload sync ...</code> command, below.</p>
<p>The kubectl kcp plugin binaries should be first in your path so kubectl picks them up.</p>
<pre><code class="language-bash">which kubectl-kcp
</code></pre>
<p>should point to the kubectl-kcp you have just built in your <code>$GOPATH/bin</code>, and not any other installed version.</p>
<h3 id="start-kcp-on-another-terminal">Start kcp on another terminal</h3>
<pre><code class="language-bash">kcp start
</code></pre>
<h3 id="running-in-a-kind-cluster-with-a-local-registry">Running in a kind cluster with a local registry</h3>
<p>You can run the syncer in a kind cluster for development.</p>
<ol>
<li>Create a <code>kind</code> cluster with a local registry to simplify syncer development
   by executing the following script:</li>
</ol>
<p><code>bash
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/kubernetes-sigs/kind/main/site/static/examples/kind-with-registry.sh)"</code></p>
<ol>
<li>
<p>From the kcp root directory:
    <code>bash
    export KUBECONFIG=.kcp/admin.kubeconfig</code></p>
</li>
<li>
<p>Create a location workspace and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace create my-locations --enter
Workspace "my-locations" (type root:organization) created. Waiting for it to be ready...
Workspace "my-locations" (type root:organization) is ready to use.
Current workspace is "root:my-locations" (type "root:organization").</code></p>
</li>
<li>
<p>To create the synctarget and use the image pushed to the local registry, supply <code>&lt;image name&gt;</code> to the
   <code>kcp workload sync</code> plugin command, where <code>&lt;image name&gt;</code> was captured in the build steps, above.</p>
<p><code>sh
kubectl kcp workload sync kind --syncer-image &lt;image name&gt; -o syncer.yaml</code></p>
</li>
<li>
<p>Create a second workspace for your workloads and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace ..
$ kubectl kcp workspace create my-workloads --enter
Workspace "my-workloads" (type root:organization) created. Waiting for it to be ready...
Workspace "my-workloads" (type root:organization) is ready to use.
Current workspace is "root:my-workloads" (type "root:organization").</code></p>
</li>
<li>
<p>Bind it to the <code>my-locations</code> workspace with the synctarget:</p>
<p><code>bash
kubectl kcp bind compute "root:my-locations"</code></p>
</li>
<li>
<p>Apply the manifest to the p-cluster:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl apply -f syncer.yaml
namespace/kcp-syncer-kind-1owee1ci created
serviceaccount/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci-token created
clusterrole.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
clusterrolebinding.rbac.authorization.k8s.io/kcp-syncer-kind-1owee1ci created
secret/kcp-syncer-kind-1owee1ci created
deployment.apps/kcp-syncer-kind-1owee1ci created</code></p>
<p>and it will create a <code>kcp-syncer</code> deployment:</p>
<p><code>sh
$ KUBECONFIG=&lt;pcluster-config&gt; kubectl -n kcp-syncer-kind-1owee1ci get deployments
NAME     READY   UP-TO-DATE   AVAILABLE   AGE
kcp-syncer   1/1     1            1           13m</code></p>
</li>
<li>
<p>Wait for the kcp sync target to go ready:</p>
<p><code>bash
kubectl wait --for=condition=Ready synctarget/&lt;mycluster&gt;</code></p>
</li>
<li>
<p>Add a deployment to the my-workloads workspace and check the p-cluster to see if the workload has been created there:</p>
<p><code>bash
kubectl create deployment --image=gcr.io/kuar-demo/kuard-amd64:blue --port=8080 kuard</code></p>
</li>
</ol>
<h3 id="running-locally">Running locally</h3>
<p>TODO(m1kola): we need a less hacky way to run locally: needs to be more close
to what we have when running inside the kind with own kubeconfig.</p>
<p>This assumes that KCP is also being run locally.</p>
<ol>
<li>
<p>Create a kind cluster to back the sync target:</p>
<p>```sh
$ kind create cluster
Creating cluster "kind" ...
<snip>
Set kubectl context to "kind-kind"
You can now use your cluster with:</p>
<p>kubectl cluster-info --context kind-kind
```</p>
</li>
<li>
<p>Make sure to use kubeconfig for your local KCP:</p>
<p><code>bash
export KUBECONFIG=.kcp/admin.kubeconfig</code></p>
</li>
<li>
<p>Create an organisation and immediately enter it:</p>
<p><code>sh
$ kubectl kcp workspace create my-org --enter
Workspace "my-org" (type root:organization) created. Waiting for it to be ready...
Workspace "my-org" (type root:organization) is ready to use.
Current workspace is "root:my-org" (type "root:organization").</code></p>
</li>
<li>
<p>Enable the syncer for a p-cluster:</p>
<p><code>sh
kubectl kcp workload sync &lt;mycluster&gt; --syncer-image &lt;image name&gt; -o syncer.yaml</code></p>
<p><code>&lt;image name&gt;</code> can be anything here as it will only be used to generate <code>syncer.yaml</code> which we are not going to apply.</p>
</li>
<li>
<p>Gather data required for the syncer:</p>
<p><code>bash
syncTargetName=&lt;mycluster&gt;
syncTargetUID=$(kubectl get synctarget $syncTargetName -o jsonpath="{.metadata.uid}")
fromCluster=$(kubectl ws current --short)</code></p>
</li>
<li>
<p>Run the following snippet:</p>
<p><code>bash
go run ./cmd/syncer \
  --from-kubeconfig=.kcp/admin.kubeconfig \
  --from-context=base \
  --to-kubeconfig=$HOME/.kube/config \
  --sync-target-name=$syncTargetName \
  --sync-target-uid=$syncTargetUID \
  --from-cluster=$fromCluster \
  --resources=configmaps \
  --resources=deployments.apps \
  --resources=secrets \
  --resources=serviceaccounts \
  --qps=30 \
  --burst=20</code></p>
</li>
<li>
<p>Wait for the kcp sync target to go ready:</p>
<p><code>bash
kubectl wait --for=condition=Ready synctarget/&lt;mycluster&gt;</code></p>
</li>
</ol></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="../../../../search/main.js" defer></script>
        <script src="../../../../js/version-select.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
